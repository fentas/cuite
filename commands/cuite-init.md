---
description: Scan project and bootstrap domain structure
argument-hint: [--force]
allowed-tools: Read, Glob, Grep, Write, Edit, Bash, AskUserQuestion, TodoWrite
---

# `/cuite-init` - Domain Bootstrapper

Scans your project, detects domains, and generates all the configuration files needed for the agent framework.

## When to Use

- **First time:** After `bin/cuite init` sets up the subtree and symlinks
- **New domains:** When your project grows and needs additional domains
- **Re-bootstrap:** With `--force` to regenerate everything from scratch

## Step 1: Detect Existing Setup

Check current state before making changes:

1. **Read `.claude/domains.md`** — does it exist? Does it have non-comment entries?
2. **Scan `.claude/agents/experts/*/`** — any domain directories with `expertise.yaml` or `tips.md`?
3. **Read `.claude/domain-map.conf`** — any non-comment mappings?

**If anything exists and `$ARGUMENTS` does NOT contain `--force`:**
- Report what's already configured
- Ask user:
  ```
  AskUserQuestion: "Existing domain setup detected. What would you like to do?"
  Options: ["Extend — add new domains alongside existing", "Overwrite — regenerate everything (--force)", "Cancel — keep current setup"]
  ```
- On "Cancel": exit gracefully with current state summary

## Step 2: Scan Project

Analyze the repository to identify natural domain boundaries:

### Language & Framework Detection

Glob for project markers and read their contents:

```
**/Cargo.toml         → Rust
**/package.json       → JavaScript/TypeScript (check for React, Vue, Express, etc.)
**/go.mod             → Go
**/requirements.txt   → Python
**/pyproject.toml     → Python
**/Gemfile            → Ruby
**/build.gradle       → Java/Kotlin
**/pom.xml            → Java
**/Makefile           → Multi-language (read for clues)
**/docker-compose*    → DevOps/Infrastructure
**/Dockerfile*        → DevOps/Containers
**/.github/workflows/ → CI/CD
**/helm/              → Kubernetes
**/k8s/               → Kubernetes
**/*.proto            → gRPC/Protocol Buffers
```

### Directory Structure Analysis

- Read top-level directory listing
- Identify `src/` subdirectories and their purposes
- Look for monorepo patterns (packages/, apps/, services/)
- Check for standard layouts (cmd/, internal/, pkg/ for Go; src/lib/ for Rust)

### Architecture Clues

- Read `README.md` for project description and structure
- Check for `docs/` directory with architecture docs
- Read `CLAUDE.md` project structure table (if already populated)

## Step 3: Propose Domains

Based on the scan, propose 3-7 domains. For each domain, determine:

- **Name**: Short, lowercase, hyphenated (e.g., `backend`, `frontend`, `infra`)
- **Description**: One-line summary
- **Keywords**: Terms that match user requirements to this domain
- **Paths**: Glob patterns for files in this domain
- **Language**: Primary language/framework
- **Build command**: How to build this domain
- **Test command**: How to test this domain

### Present to User

Format the proposal as a clear table and ask:

```
AskUserQuestion: "I detected these domains. Shall I proceed?"
Options: ["Looks good — generate everything", "Let me adjust the list first"]
```

If user wants adjustments: ask follow-up questions about what to add/remove/rename.

### Domain Identification Guidelines

- **One domain per cohesive area** with its own language, toolchain, or expertise
- **3-7 domains** is the sweet spot (see agent-teams-blueprint.md Phase 2)
- **Don't over-split**: a React app with components + pages + hooks is one domain, not three
- **Do split**: backend API vs frontend UI, even if same language
- **Infrastructure is usually its own domain**: CI/CD, Docker, K8s

## Step 4: Generate Files

On user approval, create all files using TodoWrite to track progress:

### 4a: `.claude/domains.md`

Write the domain registry following the template format:

```markdown
# Project Domains

## {domain}

- **Description**: {description}
- **Keywords**: {keywords}
- **Paths**: {paths}
- **Language**: {language}
- **Build**: `{build_command}`
- **Test**: `{test_command}`
```

### 4b: `.claude/domain-map.conf`

Generate glob-to-domain mappings from the detected paths:

```
# Auto-generated by /cuite-init
{path-glob-1} = {domain}
{path-glob-2} = {domain}
```

**If extending**: append new mappings below existing ones.

### 4c: Expert Directories

For each domain, create `.claude/agents/experts/{domain}/` with:

**`tips.md`** — starter operational tips:
```markdown
# {Domain} — Operational Tips

## Build & Test

- Build: `{build_command}`
- Test: `{test_command}`
- Lint: `{lint_command if detected, otherwise "(configure)"}`

## Key Paths

- Source: `{primary source path}`
- Tests: `{test path if detected}`
- Config: `{config files if detected}`

## Gotchas

- (Add operational gotchas as you discover them)
```

**`expertise.yaml`** — starter expertise:
```yaml
domain: {domain}
version: "1.0"
description: {description}

overview: |
  {Brief description based on what was detected during scan.
   Include language, framework, and primary responsibility.}

key_paths:
  source: {source_path}
  tests: {test_path}
  config: {config_path}

build_commands:
  build: "{build_command}"
  test: "{test_command}"

coding_standards:
  - "(Populate after first /improve cycle)"

critical_patterns: {}
  # Populated by improve-agent after review cycles
```

### 4d: `CLAUDE.md` Project Structure Table

If `CLAUDE.md` contains the placeholder table from the template, update it:

```markdown
## Project Structure

| Sub-project | Language   | Path       |
|-------------|------------|------------|
| {domain-1}  | {lang-1}   | `{path-1}` |
| {domain-2}  | {lang-2}   | `{path-2}` |
```

**Only update if** the table still has the `example-api` / `example-ui` placeholders.

## Step 5: Report

```markdown
## /cuite-init Complete

### Created
- `.claude/domains.md` — {N} domains registered
- `.claude/domain-map.conf` — {M} path mappings
- {N} expert directories with starter tips.md + expertise.yaml

### Domains
| Domain | Language | Paths |
|--------|----------|-------|
| ... | ... | ... |

### Next Steps
- Run `/do <task>` to start working — agents will use your new domains
- Run `/do-teams <task>` for parallel multi-domain work
- Expertise improves automatically via the plan-build-review-improve cycle
- Run `/improve` after sessions to capture learnings
```
